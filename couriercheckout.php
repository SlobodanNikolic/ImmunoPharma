<?php
  session_start();
?>
<!DOCTYPE html>
<html lang="en">

  <head>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123764379-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123764379-1');
    </script>

       <!-- Facebook Pixel Code -->
<script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '2146199148745001');
  fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=2146199148745001&ev=PageView&noscript=1"
/></noscript>
<!-- End Facebook Pixel Code -->

    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8"></meta>

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Poručivanje proizvoda, Immuno Pharma D.O.O. Beograd">

    <title>Poručivanje proizvoda : Immuno G, Holesterol Ex Complex, Acid Ex, Natural Q10, Immuno Pharma</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lato|Roboto" rel="stylesheet">
    <!-- Add icon library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Custom styles for this template -->
    <link href="css/scrolling-nav.css" rel="stylesheet">

    <link href="css/popup.css" rel="stylesheet">
    <script type="text/javascript" src="js/popup.js"></script>

    <script type="text/javascript" src="js/courier.js"></script>

  

    <style type="text/css">
      
      .form-check{
      margin-left: -90px;
    }
      
      header{
        background-color: #FFFBFA;
        /*font-family: 'Lato', sans-serif;
        font-family: 'Roboto', sans-serif;*/
      }

      nav{

        /*border: 1px solid #0093A9;*/
      }

      .title-div{

         width: 100%;
         text-align: center;

      }

      .segment1{
        background-image: 
        linear-gradient(
          rgba(0, 0, 0, 0.4),
          rgba(0, 0, 0, 0.4)
        ),
        url(images/family2.jpg);
        font-family: 'Lato', sans-serif;
        font-size: 30px;
        height: 750px;
        color:white;
        /*background-image: url("images/family2.jpg");*/
        background-repeat:no-repeat;
        background-size:cover;
      }

      #info{
        float: right;
        margin-top: -120px;
        color: white;
        width: 300px;
      }

      .segment2{
        background-color: white;
        color: gray;
        padding-top: 80px;
        padding-bottom: 80px;
        /*border: 1px solid black;*/
        margin-bottom: 0px;
        font-family: 'Roboto', sans-serif;
      }

      .segment3{
        background-color: #cc3971;
        color: white;
        font-family: 'Roboto', sans-serif;
      }

      .image-text{
        margin-top: 20px;
        margin-bottom: 20px;
        font-family: 'Roboto', sans-serif;
      }

      .product-row{
        margin-top: 40px;
      }

      .card-footer{
        background-color: white;
        font-family: 'Roboto', sans-serif;
      }

      #shop{
        /*border: 1px solid black;*/
        margin-top: 0px;
        /*background-color: gray;*/
      }

      #shop-segment{
        color: gray;
        /*background-color: #158EA2FF;*/
        /*background-color: rgba(21, 142, 162, 1);*/

        /*border: 1px solid black;*/
        padding-top: 80px;
        background-color: #F2F4FAFF;
        font-family: 'Roboto', sans-serif;
        
      }

      hr{
        background-color: #0090a6;
        /*#FF1083*/
      }

      

    </style>
    <script src='https://www.google.com/recaptcha/api.js'></script>

  </head>

  <body id="page-top">
  <script type="text/javascript" src="js/fb.js"></script>
  <script>
    fbq('track', 'Purchase', {
      content_ids: 'com.immunopharma.purchase',
      content_type: 'product',
    });
  </script>



    <!-- Navigation -->
   <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav" style="background-color: #1590A5FF;
        color: white;">
      <div class="container">

        <img class="navbar-brand js-scroll-trigger" style="width: 40px; height: 45px;" src="images/logo6.png"/>
        <a class="navbar-brand js-scroll-trigger" href="#page-top">Immuno Pharma</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="index.php#about">O nama</a>
            </li>

            <li class="nav-item">
              <a class="nav-link js-scroll-trigger nav-title" href="index.php#products">Proizvodi</a>
            </li>

            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="clanci.html">Članci</a>
            </li>
            
            
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger nav-title" href="index.php#ask">Pitajte doktora</a>
            </li>

            <!-- <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="video.php">Emisije</a>
            </li> -->

            <li class="nav-item">
              <a href="cart.php" id="cart" class="nav-link js-scroll-trigger"><i class="fa fa-shopping-cart" id="cart-icon"></i> Korpa</a>
            </li>
          </ul>

          
        </div>
      </div>
    </nav>


    <?php 

      function errorHandle($mes) {
          echo "<script type='text/javascript'>alert('$mes');</script>";
      }

      function addProducts(){

        $orderString = "";

        if(isset($_SESSION["ig500"]) && $_SESSION["ig500"]!= "") {
          $orderString.= "Immuno G + 500: " . $_SESSION["ig500"] . "\n";
        }
        if(isset($_SESSION["ig100"]) && $_SESSION["ig100"]!= "") {
          $orderString.= "Immuno G + 100: " . $_SESSION["ig100"] . "\n";
        }
        if(isset($_SESSION["holex"]) && $_SESSION["holex"]!= "") {
          $orderString.= "Holesterol-Ex Complex: " . $_SESSION["holex"] . "\n";
        }
        if(isset($_SESSION["acidex"]) && $_SESSION["acidex"]!= "") {
          $orderString.= "Acidex: " . $_SESSION["acidex"] . "\n";
        }
        if(isset($_SESSION["q10"]) && $_SESSION["q10"]!= "") {
          $orderString.= "Natural Q10: " . $_SESSION["q10"] . "\n";
        }

        return $orderString;
        
      }

      if (isset($_POST['submit'])) {

        if(isset($_SESSION['message_sent'])){
          if(!$_SESSION['message_sent']){
            unset($_SESSION['message_sent']);
            echo "<h2>Nije poslato</h2>";
            exit;
          }
          else{
            unset($_SESSION['message_sent']);
            echo '<script type="text/javascript">alert("Vaše pitanje je uspešno poslato. Neko od naših lekara će Vam odgovoriti, u što kraćem roku.");</script>';

            exit;
          }
        }

        if(isset($_POST['g-recaptcha-response'])){
          $captcha=$_POST['g-recaptcha-response'];
        }
        if(!$captcha){
          $_SESSION["message_sent"] = false;
          echo "<h2>Fali captcha</h2>";
          exit;
        }

        $secretKey = "6Le403EUAAAAAOxYGXWxvDgkzhx4cG1S-OazjAEJ";
        $ip = $_SERVER['REMOTE_ADDR'];
        $response=file_get_contents("https://www.google.com/recaptcha/api/siteverify?secret=".$secretKey."&response=".$captcha."&remoteip=".$ip);
        $responseKeys = json_decode($response,true);


        if(intval($responseKeys["success"]) !== 1){
          $_SESSION["message_sent"] = false;
          echo "<h2>captcha je negativan</h2>";
          exit;
        }
        else{

          $error2 = 0;
          $msg2 = "";

          $first_name2 = $_POST['first_name2'];
          $last_name2 = $_POST['last_name2'];
          $phone = $_POST['phone'];
          $email2 ="";
          $city = $_POST['city'];
          $postal = $_POST['postal'];
          $adress = $_POST['adress'];


          if(isset($_POST['email2'])){
            $email2 = $_POST['email2'];

            if($email2 != ""){
              $email2 = filter_var($email2, FILTER_SANITIZE_EMAIL);

              // Validate e-mail
              if (!filter_var($email2, FILTER_VALIDATE_EMAIL)) {
                $error2 = 1;
                $msg2 = "Niste uneli ispravan email.";
              }
            }
          }

          $first_name2 = htmlspecialchars($first_name2, ENT_QUOTES);
          if (!preg_match ('/^[a-zA-Z\s\p{L}]+$/u', $first_name2, $matches)){
            //echo "<script type='text/javascript'>alert('ne');</script>";
            $error2 = 1;
            $msg2 = "Niste uneli ispravno ime.";
          }

          $last_name2 = htmlspecialchars($last_name2, ENT_QUOTES);
          if (!preg_match ('/^[a-zA-Z\s\p{L}]+$/u', $last_name2, $matches)){
            $msg2 = "Niste uneli ispravno prezime.";

            //echo "<script type='text/javascript'>alert('ne');</script>";
            $error2 = 1;
          }

          $phone = trim(filter_var($phone, FILTER_SANITIZE_STRING, FILTER_FLAG_STRIP_HIGH));
          if (!preg_match ('/^[0-9\s\/\-\+,]+$/', $phone, $matches)){
            $msg2 = "Niste uneli ispravan broj telefona.";

            //echo "<script type='text/javascript'>alert('ne');</script>";
            $error2 = 1;
          }

          $city = htmlspecialchars($city, ENT_QUOTES);
          if (!preg_match ('/^[a-zA-Z\s\p{L}]+$/u', $city, $matches)){
            $msg2 = "Niste uneli ispravan naziv grada.";

            $error2 = 1;
          }

          $postal = trim(filter_var($postal, FILTER_SANITIZE_STRING, FILTER_FLAG_STRIP_HIGH));
          if (!preg_match ('/^[0-9\s\/\-\+]+$/', $postal, $matches)){
            $msg2 = "Niste uneli ispravan postanski broj.";
            
            $error2 = 1;
          }

          $adress = htmlspecialchars($adress, ENT_QUOTES);
          if (!preg_match ('/^[a-zA-Z0-9\s\/\-\+\p{L}]+$/u', $adress, $matches)){
            $msg2 = "Niste uneli ispravnu adresu.";
            
            $error2 = 1;
          }
          
          if($error2 == 1){
            errorHandle($msg2);
          }
          else if($error2 == 0){

            $order = addProducts();

            $_SESSION["first_name2"] = $first_name2;
            $_SESSION["last_name2"] = $last_name2;
            $_SESSION["phone"] = $phone;
            $_SESSION["email2"] = $email2;
            $_SESSION["city"] = $city;
            $_SESSION["postal"] = $postal;
            $_SESSION["adress"] = $adress;

            $email_from = "immunopharma@sezampro.rs";

            $email_subject = "Poručivanje proizvoda - immunopharma.rs";

            $email_body = $first_name2 . " \n" . $last_name2 . "\n". $phone . ", " . $email2 . "\n" . $city . "\n" . $postal . "\n" . $adress . "\n" . $order;

            $where = $email2;

            $to = "order.immunopharma@gmail.com";

            $headers = "From: $email_from \r\n";

            $headers .= "Reply-To: immunopharma@sezampro.rs \r\n";

            mail($to,$email_subject,$email_body,$headers);

            unset($_SESSION['ig500']);
            unset($_SESSION['ig100']);
            unset($_SESSION['acidex']);
            unset($_SESSION['holex']);
            unset($_SESSION['q10']);


            echo '<script language="javascript">';
            echo 'localStorage.removeItem("immunoG500");
                  localStorage.removeItem("immunoG100");
                  localStorage.removeItem("holex");
                  localStorage.removeItem("acidex");
                  localStorage.removeItem("q10");';
            echo 'alert("Vaša porudžbina je uspešno poslata. Osoba zadužena za porudžbinu će Vas pozvati u roku od jednog radnog dana, radi potvrde. Hvala na poverenju.")';
            echo '</script>';

            echo '<script language="javascript">';
            echo 'location.assign("index.php#products");';
            echo '</script>';

          }

      }
        

      }

    ?>


    <section id = "main-section">


      <div class="container">
        <div class = "title-div">
          <h3>Podaci o kupcu</h3>
        </div>

        <form class="needs-validation" id="questionForm" novalidate method="post" accept-charset="UTF-8">
          <div class="form-group">
            <label for="firstName">Ime</label>
            <input type="text" class="form-control" name="first_name2" id="firstName" placeholder="Ime">
            <div class="invalid-feedback">
              Molim Vas, unesite ispravno ime. (Dozvoljeni su svi slovni karakteri)
            </div>
            <div class="valid-feedback">
              Ime ispravno unešeno.
            </div>
          </div>

          <div class="form-group">
            <label for="lastName">Prezime</label>
            <input type="text" class="form-control" name="last_name2" id="lastName" placeholder="Prezime">
            <div class="invalid-feedback">
              Molim Vas, unesite ispravno prezime. (Dozvoljeni su svi slovni karakteri)
            </div>
            <div class="valid-feedback">
              Prezime ispravno unešeno.
            </div>
          </div>

          <div class="form-group">
            <label for="phone">Telefon</label>
            <input type="text" class="form-control" name="phone" id="phone" placeholder="Broj telefona">
            <div class="invalid-feedback">
              Molim Vas, unesite broj ispravan broj telefona. (Dozvoljeni numericki karakteri, kao i karakteri '+', '-', '/')
            </div>
            <div class="valid-feedback">
              Broj telefona ispravno unešen.
            </div>
          </div>
          
          </br>

          <div class = "title-div">
            <h3>Adresa za dostavu</h3>
            <br/>
          </div>

          <div class="form-group">
            <label for="city">Grad</label>
            <input type="text" class="form-control" name="city" id="city" placeholder="Grad">
            <div class="invalid-feedback">
              Molim Vas, unesite naziv ispravan naziv grada. (Dozvoljeni su svi slovni karakteri)
            </div>
            <div class="valid-feedback">
              Naziv grada ispravno unešen.
            </div>
          </div>

          <div class="form-group">
            <label for="code">Poštanski broj</label>
            <input type="text" class="form-control" id="postal" name="postal" placeholder="Poštanski broj">
            <div class="invalid-feedback">
              Molim Vas, unesite poštanski broj. (Dozvoljeni su svi numerički karakteri)
            </div>
            <div class="valid-feedback">
              Poštanski broj ispravno unešen.
            </div>
          </div>

          <div class="form-group">
            <label for="adress">Adresa</label>
            <input type="text" class="form-control" id="adress" name="adress" placeholder="Naziv ulice i broj stana ili kuće">
            <div class="invalid-feedback">
              Molim Vas, unesite naziv ulice i broj. (Primer: Vizantijski Bulevar 93/6)
            </div>
            <div class="valid-feedback">
              Adresa ispravno unešena.
            </div>
          </div>

          <div class="g-recaptcha" data-sitekey="6Le403EUAAAAAM4ZCLk3e1-95SqGu-2k5LhWJyFQ"></div>
          <span id="captcha" style="color:red; font-size: 13px;"></span>
          
          <br/>
          <br/>

          <button type="submit" name="submit" class="btn btn-success">Završi kupovinu</button>
        </form>

      </div>
    </section>


    <footer class="py-5" style="padding: 30px; background-color: #1590A5FF;">
      <div class="container">

        <iframe src="https://www.facebook.com/plugins/page.php?href=https%3A%2F%2Fwww.facebook.com%2FImmuno-Pharma-233817897179199%2F&tabs=timeline&width=300&height=70&small_header=false&adapt_container_width=true&hide_cover=false&show_facepile=true&appId=209720689783767" width="100%" height="130" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>

        <!-- <p class="m-0 text-center text-white">Copyright &copy; Shlijani 2018</p> -->
      </div>

      <div id="info">
        Immuno Pharma D.O.O.</br>
        Beograd</br>

        Broj telefona besplatnog savetovališta:
        +381 11 3987747
      </div>
      <!-- /.container -->
    </footer>

    <div id="myModal" class="modal">

      <!-- Modal content -->
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="text">Besplatno savetovalište</h2>
          <span class="close">&times;</span>
        </div>
        <div class="modal-body">
          <p class="text">U Beogradu postoji besplatno savetovalište, u kome rade stručnjaci iz oblasti medicine i farmacije, sa kojima možete razgovarati i dobiti savete vezane za zdravlje. Savetovalište funkcioniše po principu kol centra, radnim danima od 9h - 17h. Pozivi se ne naplaćuju dodatno.</p>
          <p class="text">Broj telefona savetovališta: <b>011 398 77 47</b></p>
        </div>
        
      </div>

    </div>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom JavaScript for this theme -->
    <script src="js/scrolling-nav.js"></script>

  </body>

</html>
